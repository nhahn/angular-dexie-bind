/*! angular-dexie-bind - v0.0.2 - 2015-07-05
* https://github.com/nhahn/angular-dexie-bind
* Copyright (c) 2015 Nathan Hahn; Licensed MIT */
function diff(a,b){return a.filter(function(a){return b.indexOf(a)<0})}!function(){var a={};db.on("ready",function(){db.on("changes",function(b){for(var c=0;c<b.length;c++){var d=b[c],e=a[d.table];if(e)for(var f=0;f<e.length;f++)e[f](d)}})}),window.DexieSet=function(){function b(a,c,d){var e=Object.create(Array.prototype);return e=Array.apply(e,d)||e,e.query=a,e.context=a._ctx,e.$scope=c,e.$listener=function(a){c.$apply(function(){if(1==a.type){for(var b=0;b<e.length;b++)if(a.obj[e.context.table.schema.primKey.name]==e[b][e.context.table.schema.primKey.name])return;if(e.context.or||0!=e.context.offset)return void e.$requery();if(e.$filter(a))for(var b=0;b<e.length;b++)if("prev"==e.context.dir){if(e[b][e.context.index]<=a.obj[e.context.index])return void e.splice(b,0,new DexieRecord(e.context,e.$scope,a.obj))}else if(e[b][e.context.index]>=a.obj[e.context.index])return void e.splice(b,0,new DexieRecord(e.context,e.$scope,a.obj))}else if(2==a.type){for(var b=0;b<e.length;b++)if(e[b][e.context.table.schema.primKey.name]==a.key)return void(e.$filter(a)&&(e[b]=new DexieRecord(e.context,e.$scope,a.obj)))}else if(3==a.type){if(e.context.limit!=1/0)return void e.$requery();for(var b=0;b<e.length;b++)e[b][e.context.table.schema.primKey.name]==a.key&&e.splice(b,1)}})},b.injectClassMethods(e),e.$bind(),e.$scope.$on("$destroy",function(){e.$unbind()}),e}return b.injectClassMethods=function(a){for(var c in b.prototype)b.prototype.hasOwnProperty(c)&&(a[c]=b.prototype[c]);return a},b.fromArray=function(a,c,d){var e=b.apply(null,[a,c,d]);return e},b.isArray=function(a){var b=Object.prototype.toString.call(a);return"[object array]"===b.toLowerCase()},b.prototype={$add:function(a){return this.context.table.add(a)},$update:function(a,b){return this.context.table.update(a,b)},$delete:function(a){return this.context.table["delete"](a)},$requery:function(){return this.length=0,this.query.toArray().then(function(a){this.$scope.$apply(function(){for(var b=0;b<a.length;b++)this[b]=new DexieRecord(this.context,this.$scope,a[b])})})},$bind:function(){a[this.context.table.name]=a[this.context.table.name]||[],a[this.context.table.name].push(this.$listener)},$unbind:function(){for(var b=0;b<a[this.$listener.table.name].length;b++)this.$listener==a[this.$listener.table.name][b]&&a[this.$listener.table.name].splice(b,1)},$filter:function(a){if(this.context.range){if(this.context.range.lower)if(this.context.range.lowerOpen){if(a.obj[this.context.index]<=this.context.range.lower)return!1}else if(a.obj[this.context.index]<this.context.range.lower)return!1;if(this.context.range.upper)if(this.context.range.upperOpen){if(a.obj[this.context.index]>=this.context.range.upper)return!1}else if(a.obj[this.context.index]>this.context.range.upper)return!1}return this.context.isMatch&&!this.context.isMatch(a.obj)?!1:!0}},b}.call({}),window.DexieRecord=function(){function a(b,c,d){for(var e in a.prototype)a.prototype.hasOwnProperty(e)&&(d[e]=a.prototype[e]);return d.$context=b,d.$scope=c,d}return a.prototype={$copy:function(){var a={};for(var b in this)this.hasOwnProperty(b)&&!b.match(/^\$/)&&(a[b]=this[b]);return a},$save:function(){return this.$context.table.put(this.$copy())}},a}.call({});var b=angular.module("ngDexieBind",[]);b.factory("$dexieBind",["$q","$rootScope","$timeout","$log",function(a,b,c,d){var e=function(b,c,d){var e=new a.defer,f=c._ctx.table,g=[];f.schema.mappedClass;return c.toArray().then(function(a){d.$apply(function(){for(var b=0;b<a.length;b++)a[b]=new DexieRecord(c._ctx,d,a[b]);g=DexieSet.fromArray(c,d,a),e.resolve(g)})})["catch"](function(a){d.$apply(function(){e.reject(a)})}),e.promise};return{bind:e}}])}(),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(f in c&&(b=c[f],a.call(e,b,f,c)))return b;return void 0}}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});